<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Modelos Multinivel</title>
    <meta charset="utf-8" />
    <meta name="author" content=".small[Juan Carlos Castillo    Departamento de Sociología - UCH / COES   ]" />
    <script src="libs/header-attrs-2.21/header-attrs.js"></script>
    <script src="libs/fabric-4.3.1/fabric.min.js"></script>
    <link href="libs/xaringanExtra-scribble-0.0.1/scribble.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-scribble-0.0.1/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link rel="stylesheet" href="css/custom_2020.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: front








.pull-left-wide[
# Modelos multinivel]

.pull-right-narrow[![:scale 85%](img/logo.png)]

## Unidades en contexto

----
.pull-left[

## Juan Carlos Castillo
## Sociología FACSO - UChile
## 2do Sem 2023 
## [.yellow[multinivel-facso.netlify.com]](https://multinivel-facso.netlify.com)
]
    

.pull-right-narrow[
.center[
.content-block-gray[
## Sesión 6: 
## **.yellow[Predicción de efectos aleatorios]**]
]
]
---

layout: true
class: animated, fadeIn

---
class: roja right
# Contenidos


## .yellow[1- Resumen sesión anterior]

## 2- Predicción de efectos aleatorios



---
# Componentes de la varianza

![:scale 60%](images/tau00.png)
---
# Componentes de la varianza


![:scale 60%](images/taus.png)

  
---
## Correlación intra clase: ICC

-   La correlación intra-clase ( `\(\rho\)` ) indica qué porcentaje de la
    varianza de la variable dependiente se debe a pertenencia a unidades     de nivel 2

-   Descomposición de la varianza en modelo nulo=
    `\(Var\ y=\tau_{00} + \sigma^2\)`

-   Es decir, parte de la varianza se debe a los individuos ( `\(\sigma^2\)` )
    y parte al grupo ( `\(\tau_{00}\)` )

---
class: roja, middle, center

# Correlación intra-clase

## "Proporción de la varianza de la variable dependiente que se asocia a la pertenencia a unidades de nivel 2"


---
# librería lme4

-   función lmer (linear mixed effects)

-   forma general:

    -   `objeto &lt;- lmer (depvar ~ predictor_1 + predictor_2 + predictor_n + (1 | cluster), data=data)`

    -   el objeto contiene la información de la estimación; para ver un resumen, `summary(objeto)`, y de manera más presentable,`screenreg(objeto)`


---
# Tipos de medidas de ajuste

1. Medidas relativas a la varianza de efectos aleatorios (tipo `\(R^2\)`)

2. Medidas de fit comparativo (deviance)

---
##  Ajuste por proporción de varianzas

![](../images/var_pred.png)

---
## Bryck &amp; Raudenbush R2 multinivel (1992)

- lógica general: calcular la diferencia entre componentes de la varianza entre los modelos estimados

- modelo base para la comparación: modelo nulo

- luego, a medida que se agregan modelos, se compara en que medida los componentes de la varianza van disminuyendo a medida que se agregan predictores


---
## Bryck &amp; Raudenbush - R2 Nivel 2

.pull-left[

Para Nivel 2: 

&lt;br&gt;

`$$\begin{split}
   R^2_{2B\&amp;R}&amp;=\frac{var_0(\mu_{0j})-var_f(\mu_{0j})}{var_0(\mu_{0j})} \\\\
    &amp;=\frac{\tau_{00}(0)-\tau_{00}(f)}{\tau_{00}(0)}
    \end{split}$$`
]

.pull-right[
&lt;br&gt;
Donde:

-   `\(0\)` se refiere al modelo nulo

-   `\(f\)` se refiere a un modelo posterior
]
---
## Bryck &amp; Raudenbush - R2 Nivel 2
----
.medium[

  | `\(\sigma^2\)`   | `\(\tau_{00}\)` |  `\(R^2_{L1}\)` |  `\(R^2_{L2}\)`
--|----------|-----|-----|--
Modelo 0                   |  39.148   | 8.553 |   |
Modelo 1 (predict.ind.)    |  36.813   |  4.492 | 0.059 |   
Modelo 2 (predict.grup.)   |  39.161   |  2.314 |  0.00 |0.73 
]

Ej: `\(R^2_{L2}=(8.553-2.314)/8.553=6.239/8.553=0.73\)`

-   Recordar interpretación en relación a correlación intra-clase (para
    el caso de HSB data= 0.18): para el caso del R2 nivel 2 se está dando cuenta del 73% del 18%


---
## 2. Ajuste comparativo

### Deviance test

-   El test o estadístico de deviance **compara el ajuste** de dos modelos
    basado en la log verosimilitud de cada modelo

-   La hipótesis a contrastar es si predictores adicionales del modelo
    mejoran o no el ajuste

-   Asume que los **modelos son anidados**, es decir, que un modelo con
    menos predictores puede ser derivado del modelo mayor mediante la
    fijación de ciertos coeficientes como 0.

-   Deviance= `\(-2*LL\)` (LL=Log Likelihood)

-   Deviance test= `\(deviance(anidado)-deviance(mayor)\)`


---
class: roja right
# Contenidos


## 1- Resumen sesión anterior

## .yellow[2- Predicción de efectos aleatorios]


---
# Modelo con coeficientes aleatorios

-   El modelo permite la estimación de coeficientes fijos y aleatorios

-   Fijos: los mismos para todos los casos

-   Aleatorios: distintos entre grupos, pero iguales dentro de cada grupo

---
# Modelo con coeficientes aleatorios (2)

- En general, se utiliza el termino .roja[efectos aleatorios] para el modelo nulo, y .red[coeficientes aleatorios] para modelos con pendiente aleatoria.

-   En este curso, vamos a utilizar “efecto” para referirnos a las
    desviaciones de cada grupo, y “coeficientes” para la estimación
    total del grupo (coeficiente=efecto fijo + efecto aleatorio)

---
# Modelo con coeficienes aleatorios
&lt;br&gt;

![:scale 70%](images/raneffects.JPG)


---
# Modelo con coeficientes aleatorios

-   A partir de la estimación del modelo, es posible predecir el valor
    de los efectos aleatorios ( `\(\mu\)` ) para cada unidad de nivel 2

-   Para el intercepto: `\(\mu_{01},\mu_{02},\mu_{03} ... \mu_{0N}\)`

-   Para la pendiente `\(\gamma_{10}\)` : `\(\mu_{11},\mu_{12},\mu_{13} ... \mu_{1N}\)`

-   Para la pendiente `\(\gamma_{20}\)` : `\(\mu_{21},\mu_{22},\mu_{23} ... \mu_{2N}\)`

---
# ¿Cómo se estima la varianza de los efectos aleatorios?

- el modelo multinivel no estima los coeficientes aleatorios, y a partir de ahí la varianza, sino que es al reves:

.center[
.content-box-red[
.red[El modelo multinivel estima los componentes de la varianza (por cada nivel), y a partir de esa estimación realiza una predicción de los efectos aleatorios]

]


Por lo tanto, el "intercepto" (y/o pendiente) para cada grupo es una .roja[estimación] posterior a la obtención de parámetros multinivel
]

---
# (Post) estimación de efectos aleatorios

.medium[
-   El valor de los efectos aleatorios se puede (pos)estimar mediante el
    método de **empirical bayes**, que produce las medias posteriores para cada efecto por unidad de nivel dos (ej:escuela, país)

-   **Bayesiano** quiere decir que utiliza conocimiento previo (prior) para la estimación, que se relaciona con los parámetros del modelo desde
    el cual se derivan las medias posteriores
    
-   El intercepto por grupo equivale a un promedio ponderado donde se
    consideran los componentes de la varianza, el N de la unidad 2 y el
    gran intercepto `\(\gamma_{00}\)`
    
  ]

---
## (Post) estimación de efectos aleatorios


-   `\(\hat{\beta}^{EB}_{0j}=\gamma_j\hat{\beta}_{0j}+(1-\gamma_j)\hat{\gamma}_{00}\)`

.small[
-   Donde:

    -   `\(\hat{\beta}^{EB}_{0j}\)`: estimador empirical bayes del
        intercepto para el grupo `\(j\)`

    -   `\(\gamma_j\)` es un ponderador que se define como la confiabilidad
        del promedio del grupo, y que equivale a

        `$$\gamma_j=\frac{\tau_{00}}{\tau_{00}+\sigma^2/n_j}$$`

    -   `\(\hat{\beta}_{0j}\)`: es el promedio del grupo

    -   `\(\hat{\gamma}_{00}\)`: gran promedio (efecto fijo intercepto)
]
---
## (Post) estimación de efectos aleatorios

.medium[
-   En esta estimación subyace la idea del **“shrinkage”** (reducción)

-   Los coeficientes de regresión OLS de cada grupo son reducidos en la
    dirección del coeficiente promedio para todos los grupos

-   El grado de “reducción” depende del tamaño del grupo y de la
    distancia entre el promedio del grupo y el promedio general, es
    decir, de la *confiabilidad* del promedio del grupo

-   **Grupos más pequeños y que distan más del promedio serán "reducidos" de mayor manera hacia el promedio del grupo**
]
---
## Ej.Estimación de intercepto aleatorio (medias posteriores)

.small[

.pull-left[

```r
library(lme4)
mlm = read_dta("http://www.stata-press.com/data/mlmus3/hsb.dta")
results_0 &lt;-lmer(mathach ~ 1 +  (1 | schoolid), data=mlm) 
```
]


.pull-right[


```r
sjPlot::tab_model(results_0)
```

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;mathach&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;12.64&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;12.16&amp;nbsp;&amp;ndash;&amp;nbsp;13.12&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;"&gt;Random Effects&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;&amp;sigma;&lt;sup&gt;2&lt;/sup&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;39.15&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;&amp;tau;&lt;sub&gt;00&lt;/sub&gt; &lt;sub&gt;schoolid&lt;/sub&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;8.61&lt;/td&gt;

&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;ICC&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.18&lt;/td&gt;

&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;N &lt;sub&gt;schoolid&lt;/sub&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;160&lt;/td&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;7185&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;Marginal R&lt;sup&gt;2&lt;/sup&gt; / Conditional R&lt;sup&gt;2&lt;/sup&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.000 / 0.180&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

]
]

---
.medium[

.pull-left[

```r
coef(results_0) 
```

```
## $schoolid
##      (Intercept)
## 1224    9.973039
## 1288   13.376384
## 1296    8.068508
## 1308   15.585491
## 1317   13.130920
## 1358   11.394462
## 1374   10.134624
## 1433   18.905217
## 1436   17.599082
## 1461   16.333549
## 1462   10.653692
## 1477   14.119776
## 1499    8.053397
## 1637    7.832769
## 1906   15.718897
## 1909   14.173866
## 1942   17.369276
## 1946   12.880104
## 2030   12.127460
## 2208   15.209788
## 2277    9.529151
## 2305   11.232995
## 2336   16.175537
## 2458   13.886090
## 2467   10.347606
## 2526   16.726902
## 2626   13.315460
## 2629   14.740087
## 2639    7.203427
## 2651   11.250174
## 2655   12.368626
## 2658   13.326516
## 2755   16.137977
## 2768   11.156122
## 2771   11.904624
## 2818   13.752161
## 2917    8.424206
## 2990   17.945314
## 2995    9.824023
## 3013   12.612895
## 3020   14.269518
## 3039   16.194052
## 3088    9.510212
## 3152   13.163059
## 3332   14.102843
## 3351   11.587478
## 3377    9.503202
## 3427   19.114780
## 3498   16.094014
## 3499   13.208208
## 3533   10.601741
## 3610   15.174743
## 3657    9.776114
## 3688   14.463236
## 3705   10.543152
## 3716   10.595004
## 3838   15.796873
## 3881   12.017848
## 3967   12.083454
## 3992   14.486603
## 3999   11.096263
## 4042   14.204136
## 4173   12.716450
## 4223   14.440479
## 4253    9.647137
## 4292   12.849495
## 4325   13.192375
## 4350   11.950029
## 4383   11.645854
## 4410   13.389554
## 4420   13.720300
## 4458    6.401756
## 4511   13.352934
## 4523    8.729575
## 4530    9.296663
## 4642   14.462988
## 4868   12.348708
## 4931   13.706969
## 5192   10.720556
## 5404   15.209843
## 5619   15.237193
## 5640   13.121475
## 5650   14.123412
## 5667   13.699098
## 5720   14.152359
## 5761   11.258531
## 5762    5.234155
## 5783   13.080792
## 5815    8.096726
## 5819   12.180400
## 5838   13.555023
## 5937   16.215205
## 6074   13.693358
## 6089   15.214590
## 6144    8.936208
## 6170   13.906338
## 6291   10.398038
## 6366   15.436995
## 6397   12.784896
## 6415   11.920503
## 6443    9.891454
## 6464    7.842918
## 6469   18.026039
## 6484   12.880746
## 6578   12.042264
## 6600   11.773933
## 6808    9.599819
## 6816   14.393124
## 6897   14.888779
## 6990    6.502795
## 7011   13.671150
## 7101   11.959836
## 7172    8.494673
## 7232   12.550217
## 7276   12.676046
## 7332   14.463195
## 7341   10.026777
## 7342   11.273270
## 7345   11.436018
## 7364   14.028416
## 7635   14.866823
## 7688   17.973209
## 7697   15.338153
## 7734   10.915297
## 7890    8.692590
## 7919   14.607885
## 8009   13.957075
## 8150   14.644961
## 8165   16.127482
## 8175   11.811741
## 8188   12.727285
## 8193   15.888589
## 8202   11.818683
## 8357   14.130463
## 8367    6.533962
## 8477   12.534794
## 8531   13.439703
## 8627   11.022184
## 8628   16.258556
## 8707   12.862577
## 8775    9.741179
## 8800    7.995177
## 8854    5.284060
## 8857   15.120574
## 8874   12.120259
## 8946   10.539443
## 8983   11.126593
## 9021   14.542053
## 9104   16.511918
## 9158    8.868329
## 9198   18.266919
## 9225   14.439747
## 9292   10.734658
## 9340   11.376142
## 9347   13.472163
## 9359   15.062624
## 9397   10.556629
## 9508   13.466893
## 9550   11.298842
## 9586   14.704440
## 
## attr(,"class")
## [1] "coef.mer"
```
]

.pull-right[

```r
ranef(results_0) 
```

```
## $schoolid
##      (Intercept)
## 1224 -2.66393473
## 1288  0.73940984
## 1296 -4.56846563
## 1308  2.94851706
## 1317  0.49394609
## 1358 -1.24251162
## 1374 -2.50234961
## 1433  6.26824325
## 1436  4.96210829
## 1461  3.69657495
## 1462 -1.98328157
## 1477  1.48280174
## 1499 -4.58357634
## 1637 -4.80420488
## 1906  3.08192302
## 1909  1.53689246
## 1942  4.73230257
## 1946  0.24312991
## 2030 -0.50951423
## 2208  2.57281413
## 2277 -3.10782330
## 2305 -1.40397850
## 2336  3.53856279
## 2458  1.24911599
## 2467 -2.28936743
## 2526  4.08992825
## 2626  0.67848597
## 2629  2.10311300
## 2639 -5.43354661
## 2651 -1.38679960
## 2655 -0.26834758
## 2658  0.68954234
## 2755  3.50100331
## 2768 -1.48085168
## 2771 -0.73234978
## 2818  1.11518762
## 2917 -4.21276802
## 2990  5.30834044
## 2995 -2.81295064
## 3013 -0.02407879
## 3020  1.63254392
## 3039  3.55707772
## 3088 -3.12676207
## 3152  0.52608563
## 3332  1.46586922
## 3351 -1.04949536
## 3377 -3.13377137
## 3427  6.47780570
## 3498  3.45703989
## 3499  0.57123415
## 3533 -2.03523297
## 3610  2.53776920
## 3657 -2.86085994
## 3688  1.82626231
## 3705 -2.09382208
## 3716 -2.04196953
## 3838  3.15989933
## 3881 -0.61912613
## 3967 -0.55352008
## 3992  1.84962915
## 3999 -1.54071083
## 4042  1.56716203
## 4173  0.07947627
## 4223  1.80350568
## 4253 -2.98983646
## 4292  0.21252084
## 4325  0.55540098
## 4350 -0.68694440
## 4383 -0.99111943
## 4410  0.75258055
## 4420  1.08332584
## 4458 -6.23521735
## 4511  0.71596012
## 4523 -3.90739865
## 4530 -3.34031073
## 4642  1.82601437
## 4868 -0.28826542
## 4931  1.06999469
## 5192 -1.91641734
## 5404  2.57286887
## 5619  2.60021915
## 5640  0.48450127
## 5650  1.48643856
## 5667  1.06212374
## 5720  1.51538473
## 5761 -1.37844243
## 5762 -7.40281887
## 5783  0.44381843
## 5815 -4.54024780
## 5819 -0.45657380
## 5838  0.91804946
## 5937  3.57823103
## 6074  1.05638386
## 6089  2.57761596
## 6144 -3.70076593
## 6170  1.26936411
## 6291 -2.23893576
## 6366  2.80002082
## 6397  0.14792182
## 6415 -0.71647091
## 6443 -2.74551989
## 6464 -4.79405536
## 6469  5.38906505
## 6484  0.24377254
## 6578 -0.59470979
## 6600 -0.86304044
## 6808 -3.03715524
## 6816  1.75614974
## 6897  2.25180533
## 6990 -6.13417914
## 7011  1.03417644
## 7101 -0.67713815
## 7172 -4.14230123
## 7232 -0.08675681
## 7276  0.03907201
## 7332  1.82622086
## 7341 -2.61019712
## 7342 -1.36370392
## 7345 -1.20095588
## 7364  1.39144186
## 7635  2.22984902
## 7688  5.33623560
## 7697  2.70117923
## 7734 -1.72167664
## 7890 -3.94438331
## 7919  1.97091148
## 8009  1.32010086
## 8150  2.00798675
## 8165  3.49050832
## 8175 -0.82523286
## 8188  0.09031145
## 8193  3.25161501
## 8202 -0.81829092
## 8357  1.49348947
## 8367 -6.10301147
## 8477 -0.10217975
## 8531  0.80272900
## 8627 -1.61478957
## 8628  3.62158228
## 8707  0.22560316
## 8775 -2.89579513
## 8800 -4.64179681
## 8854 -7.35291359
## 8857  2.48360013
## 8874 -0.51671483
## 8946 -2.09753088
## 8983 -1.51038060
## 9021  1.90507896
## 9104  3.87494381
## 9158 -3.76864489
## 9198  5.62994490
## 9225  1.80277352
## 9292 -1.90231628
## 9340 -1.26083166
## 9347  0.83518918
## 9359  2.42565069
## 9397 -2.08034443
## 9508  0.82991907
## 9550 -1.33813133
## 9586  2.06746598
## 
## with conditional variances for "schoolid"
```
]


]


---
# Ej: escuela 1224

- con `ranef` obtenemos su efecto aleatorio `\(\mu\)` = -2.66, que equivale a su desviación del gran intercepto `\(\gamma_{00}\)`

- `\(\gamma_{00}\)` = 12.64

- el valor predicho para el intercepto de la escuela 1224 es `\(\gamma{00} + \mu_j\)`

- 12.64 + (-2.66) = 9.98 , que es el valor que se obtiene para esta escuela con la función `coef`


---
## Ej.estimación de pendiente aleatoria (medias posteriores)
.small[

```r
results_4 = lmer(mathach ~ 1 + ses + female + mnses + sector + (1 + ses | schoolid), data=mlm)
coef(results_4) # coef: comando que muestra coeficientes por grupo $id
```

```
## $schoolid
##      (Intercept)      ses    female   mnses   sector
## 1224   12.718688 2.229928 -1.185924 3.07283 1.429747
## 1288   13.118254 2.315323 -1.185924 3.07283 1.429747
## 1296   11.049900 1.893727 -1.185924 3.07283 1.429747
## 1308   12.338591 2.009420 -1.185924 3.07283 1.429747
## 1317   11.563797 1.872895 -1.185924 3.07283 1.429747
## 1358   12.147338 2.404293 -1.185924 3.07283 1.429747
## 1374   11.261404 2.215734 -1.185924 3.07283 1.429747
## 1433   13.862506 2.379662 -1.185924 3.07283 1.429747
## 1436   13.677847 2.315760 -1.185924 3.07283 1.429747
## 1461   13.372596 2.834185 -1.185924 3.07283 1.429747
## 1462   12.237417 1.630519 -1.185924 3.07283 1.429747
## 1477   12.529403 1.938104 -1.185924 3.07283 1.429747
## 1499   11.454040 2.467499 -1.185924 3.07283 1.429747
## 1637   12.006810 2.298976 -1.185924 3.07283 1.429747
## 1906   12.533231 2.120530 -1.185924 3.07283 1.429747
## 1909   13.240021 2.296086 -1.185924 3.07283 1.429747
## 1942   14.193660 2.347177 -1.185924 3.07283 1.429747
## 1946   13.279340 2.399089 -1.185924 3.07283 1.429747
## 2030   11.377733 1.835520 -1.185924 3.07283 1.429747
## 2208   12.493501 2.191759 -1.185924 3.07283 1.429747
## 2277   12.235888 1.186028 -1.185924 3.07283 1.429747
## 2305   13.404714 1.442942 -1.185924 3.07283 1.429747
## 2336   14.155767 2.337910 -1.185924 3.07283 1.429747
## 2458   12.572619 2.304372 -1.185924 3.07283 1.429747
## 2467   12.553604 2.254845 -1.185924 3.07283 1.429747
## 2526   14.521539 2.081324 -1.185924 3.07283 1.429747
## 2626   13.852562 2.481026 -1.185924 3.07283 1.429747
## 2629   13.734021 1.793893 -1.185924 3.07283 1.429747
## 2639   12.054817 1.724141 -1.185924 3.07283 1.429747
## 2651   11.764077 2.400970 -1.185924 3.07283 1.429747
## 2655   16.035512 2.674553 -1.185924 3.07283 1.429747
## 2658   11.059088 1.938731 -1.185924 3.07283 1.429747
## 2755   12.347354 1.858877 -1.185924 3.07283 1.429747
## 2768   12.174405 2.338538 -1.185924 3.07283 1.429747
## 2771   13.980828 2.501683 -1.185924 3.07283 1.429747
## 2818   13.570566 2.370264 -1.185924 3.07283 1.429747
## 2917   12.573740 1.848210 -1.185924 3.07283 1.429747
## 2990   13.342024 2.145252 -1.185924 3.07283 1.429747
## 2995   11.838660 1.850906 -1.185924 3.07283 1.429747
## 3013   13.160223 2.400036 -1.185924 3.07283 1.429747
## 3020   12.865964 2.075182 -1.185924 3.07283 1.429747
## 3039   13.245543 2.325450 -1.185924 3.07283 1.429747
## 3088   12.332119 2.064017 -1.185924 3.07283 1.429747
## 3152   13.438322 2.396298 -1.185924 3.07283 1.429747
## 3332   12.123488 2.011861 -1.185924 3.07283 1.429747
## 3351   11.006787 2.015229 -1.185924 3.07283 1.429747
## 3377   12.371916 1.578023 -1.185924 3.07283 1.429747
## 3427   16.189039 2.113855 -1.185924 3.07283 1.429747
## 3498   12.338567 1.739255 -1.185924 3.07283 1.429747
## 3499   11.078267 1.728836 -1.185924 3.07283 1.429747
## 3533   10.892292 1.721764 -1.185924 3.07283 1.429747
## 3610   13.588966 2.422726 -1.185924 3.07283 1.429747
## 3657   13.581872 2.518576 -1.185924 3.07283 1.429747
## 3688   12.410368 2.046851 -1.185924 3.07283 1.429747
## 3705    9.515435 1.541705 -1.185924 3.07283 1.429747
## 3716   13.442287 2.982233 -1.185924 3.07283 1.429747
## 3838   13.973101 1.999673 -1.185924 3.07283 1.429747
## 3881   12.057814 2.124468 -1.185924 3.07283 1.429747
## 3967   13.500676 2.382283 -1.185924 3.07283 1.429747
## 3992   12.031843 1.832326 -1.185924 3.07283 1.429747
## 3999   12.322912 2.532469 -1.185924 3.07283 1.429747
## 4042   11.656947 1.896690 -1.185924 3.07283 1.429747
## 4173   12.163090 2.273549 -1.185924 3.07283 1.429747
## 4223   13.798733 2.279179 -1.185924 3.07283 1.429747
## 4253   10.273404 1.461998 -1.185924 3.07283 1.429747
## 4292   13.420117 1.637567 -1.185924 3.07283 1.429747
## 4325   13.792054 2.438777 -1.185924 3.07283 1.429747
## 4350   11.946850 2.348998 -1.185924 3.07283 1.429747
## 4383   12.062749 2.365468 -1.185924 3.07283 1.429747
## 4410   13.191939 2.287018 -1.185924 3.07283 1.429747
## 4420   14.621465 2.361761 -1.185924 3.07283 1.429747
## 4458   12.005552 1.980520 -1.185924 3.07283 1.429747
## 4511   13.402952 1.861434 -1.185924 3.07283 1.429747
## 4523    9.513791 1.917411 -1.185924 3.07283 1.429747
## 4530   12.023144 2.042287 -1.185924 3.07283 1.429747
## 4642   14.268713 2.533765 -1.185924 3.07283 1.429747
## 4868   10.512227 1.712426 -1.185924 3.07283 1.429747
## 4931   11.601200 1.753519 -1.185924 3.07283 1.429747
## 5192   10.930830 1.907021 -1.185924 3.07283 1.429747
## 5404   11.464347 1.780138 -1.185924 3.07283 1.429747
## 5619   12.303160 2.646535 -1.185924 3.07283 1.429747
## 5640   14.231149 2.534929 -1.185924 3.07283 1.429747
## 5650   13.273346 1.947294 -1.185924 3.07283 1.429747
## 5667   11.053304 2.163370 -1.185924 3.07283 1.429747
## 5720   13.088570 2.244200 -1.185924 3.07283 1.429747
## 5761   12.686967 2.367094 -1.185924 3.07283 1.429747
## 5762   11.490666 1.948480 -1.185924 3.07283 1.429747
## 5783   12.848013 2.277046 -1.185924 3.07283 1.429747
## 5815   12.018246 2.218960 -1.185924 3.07283 1.429747
## 5819   12.007924 2.047928 -1.185924 3.07283 1.429747
## 5838   13.232824 2.193121 -1.185924 3.07283 1.429747
## 5937   13.467194 2.217537 -1.185924 3.07283 1.429747
## 6074   14.411909 2.140286 -1.185924 3.07283 1.429747
## 6089   14.726282 2.339448 -1.185924 3.07283 1.429747
## 6144   11.821378 2.244576 -1.185924 3.07283 1.429747
## 6170   14.921393 2.646232 -1.185924 3.07283 1.429747
## 6291   13.439845 2.383177 -1.185924 3.07283 1.429747
## 6366   13.139159 2.085864 -1.185924 3.07283 1.429747
## 6397   14.096697 2.412982 -1.185924 3.07283 1.429747
## 6415   13.358783 2.500028 -1.185924 3.07283 1.429747
## 6443   12.111530 1.719363 -1.185924 3.07283 1.429747
## 6464   11.739236 2.018432 -1.185924 3.07283 1.429747
## 6469   12.987687 2.152797 -1.185924 3.07283 1.429747
## 6484   13.838982 1.939921 -1.185924 3.07283 1.429747
## 6578   14.056908 2.231729 -1.185924 3.07283 1.429747
## 6600   12.719872 2.703482 -1.185924 3.07283 1.429747
## 6808   11.072415 2.061460 -1.185924 3.07283 1.429747
## 6816   11.875889 1.859838 -1.185924 3.07283 1.429747
## 6897   13.583240 2.589229 -1.185924 3.07283 1.429747
## 6990    9.886787 1.730689 -1.185924 3.07283 1.429747
## 7011   13.074902 2.533965 -1.185924 3.07283 1.429747
## 7101   12.390930 2.019152 -1.185924 3.07283 1.429747
## 7172    9.723452 1.768357 -1.185924 3.07283 1.429747
## 7232   13.547272 2.656759 -1.185924 3.07283 1.429747
## 7276   12.911277 2.557707 -1.185924 3.07283 1.429747
## 7332   12.481961 2.178251 -1.185924 3.07283 1.429747
## 7341   11.645933 1.950030 -1.185924 3.07283 1.429747
## 7342   12.109755 1.945832 -1.185924 3.07283 1.429747
## 7345   12.058370 2.666148 -1.185924 3.07283 1.429747
## 7364   13.870748 2.074413 -1.185924 3.07283 1.429747
## 7635   12.921321 2.210800 -1.185924 3.07283 1.429747
## 7688   15.182217 2.186222 -1.185924 3.07283 1.429747
## 7697   14.036678 2.461218 -1.185924 3.07283 1.429747
## 7734   13.579474 2.775843 -1.185924 3.07283 1.429747
## 7890   11.620794 1.657940 -1.185924 3.07283 1.429747
## 7919   12.846154 2.366528 -1.185924 3.07283 1.429747
## 8009   10.782401 1.743695 -1.185924 3.07283 1.429747
## 8150   12.609378 1.822869 -1.185924 3.07283 1.429747
## 8165   13.203263 2.178620 -1.185924 3.07283 1.429747
## 8175   12.963808 2.083656 -1.185924 3.07283 1.429747
## 8188   12.842029 2.440730 -1.185924 3.07283 1.429747
## 8193   14.885212 2.355826 -1.185924 3.07283 1.429747
## 8202   12.206762 2.303005 -1.185924 3.07283 1.429747
## 8357   14.518478 2.443492 -1.185924 3.07283 1.429747
## 8367    9.107836 1.608686 -1.185924 3.07283 1.429747
## 8477   13.929579 2.607668 -1.185924 3.07283 1.429747
## 8531   12.233119 2.240760 -1.185924 3.07283 1.429747
## 8627   11.306052 1.965358 -1.185924 3.07283 1.429747
## 8628   15.640972 2.182031 -1.185924 3.07283 1.429747
## 8707   12.716847 2.446274 -1.185924 3.07283 1.429747
## 8775   11.959725 1.924073 -1.185924 3.07283 1.429747
## 8800   11.521896 2.237809 -1.185924 3.07283 1.429747
## 8854   10.184219 2.133731 -1.185924 3.07283 1.429747
## 8857   12.154898 1.879477 -1.185924 3.07283 1.429747
## 8874   14.087009 2.565375 -1.185924 3.07283 1.429747
## 8946   12.734504 1.998656 -1.185924 3.07283 1.429747
## 8983   12.882791 2.009176 -1.185924 3.07283 1.429747
## 9021   11.164565 1.905033 -1.185924 3.07283 1.429747
## 9104   12.411019 2.038344 -1.185924 3.07283 1.429747
## 9158   11.883105 2.536046 -1.185924 3.07283 1.429747
## 9198   14.173518 2.479962 -1.185924 3.07283 1.429747
## 9225   13.609250 2.412433 -1.185924 3.07283 1.429747
## 9292   13.249691 2.094634 -1.185924 3.07283 1.429747
## 9340   13.549198 2.294651 -1.185924 3.07283 1.429747
## 9347   12.299050 2.224249 -1.185924 3.07283 1.429747
## 9359   12.207862 1.649750 -1.185924 3.07283 1.429747
## 9397   10.960936 1.983996 -1.185924 3.07283 1.429747
## 9508   12.858864 2.363500 -1.185924 3.07283 1.429747
## 9550   12.042265 2.373925 -1.185924 3.07283 1.429747
## 9586   11.750845 1.908395 -1.185924 3.07283 1.429747
## 
## attr(,"class")
## [1] "coef.mer"
```
]

---
## Plots

![:scale 60%](images/sjp_plot.jpeg)
---
## Plots

![:scale 60%](images/xy_plot.jpeg)

---
## Plots

![:scale 70%](images/ranef.jpeg)

---
# Resumen predicción efectos aleatorios

Usos

-   Pedagógico: para entender el sentido de la estimación con modelos
    mixtos (efectos fijos y aleatorios)

-   Diagnóstico: para analizar y visualizar la variación de unidades de
    nivel dos a nivel de intercepto y pendiente(s)

-   Informativo: para conocer los resultados de las unidades de nivel 2
    y sus variaciones

-   Contraste de hipótesis de investigación


---
class: middle

Revisar visualización:

[http://mfviz.com/hierarchical-models/](http://mfviz.com/hierarchical-models/)

---
class: front
.pull-left-wide[
# Modelos multinivel]

.pull-right-narrow[![:scale 85%](img/logo.png)]

## Unidades en contexto

----
.pull-left[

## Juan Carlos Castillo
## Sociología FACSO - UChile
## 2do Sem 2023 
## [.yellow[multinivel-facso.netlify.com]](https://multinivel-facso.netlify.com)
]
    

.pull-right-narrow[
.center[

]
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://multinivel.netlify.com/docpres/xaringan_custom/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "tomorrow-night-blue",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url("img/logo.png");
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 16.3em;
  right: 31em;
  width: 110px;
  height: 70px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
